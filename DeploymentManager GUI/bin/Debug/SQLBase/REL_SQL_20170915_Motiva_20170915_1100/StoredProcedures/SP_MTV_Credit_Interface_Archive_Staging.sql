
GO
/****** Object:  StoredProcedure [dbo].[MTV_Credit_Interface_Archive_Staging]    Script Date: 6/17/2016 10:12:15 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF  OBJECT_ID(N'[dbo].[MTV_Credit_Interface_Archive_Staging]') IS NULL
      BEGIN
			EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[MTV_Credit_Interface_Archive_Staging] AS SELECT 1'
			PRINT '<<< CREATED StoredProcedure MTV_Credit_Interface_Archive_Staging >>>'
	  END
GO

-- =======================================================================================================================================
-- Author:		Craig Albright	
-- Create date: 09/09/2016
-- Description:	Fast Archiving of Staging Records
-- =======================================================================================================================================
ALTER PROCEDURE [dbo].[MTV_Credit_Interface_Archive_Staging] WITH EXECUTE AS 'dbo'

AS
Begin
Truncate table MTVCreditInterfaceStagingArchive
End

BEGIN
--Declare @MaxID int = ((select max(exposureID) from MTVCreditInterfaceStagingArchive) + 1),
-- @SQL varchar(800) = 'SET IDENTITY_INSERT dbo.MTVCreditInterfaceStagingArchive ON',
-- @SQL1 varchar(800) = 'SET IDENTITY_INSERT dbo.MTVCreditInterfaceStagingArchive OFF'
-- exec(@SQL);



With StagingRecords (
AccountingPeriodStartDate
,AggregationGroupName
,Agreement
,AgreementType
,AttachedInHouse
,BaseUOM
,BestAvailableQuantity
,BuySell
,ChargeType
,ChmclID
,ClassOfTrade
,CloseOfBusiness
,CommDeal
,ConversionCrrncyID
,ConversionCurrency
,ConversionDeliveryPeriodID
,ConversionFactor
,CreationDate
,CurFxRate
,CurveName
,CustomStatus
,DealCoveredByLoC
,DealCurrency
,DealDetailId
,DealHeaderId
,DealNotionalValue
,DealPriceSource
,DealValueFXConversionDate
,DealValueIsMissing
,DefaultCurrency
,DefaultCurrencyID
,DeliveryPeriod
,DeliveryPeriodEndDate
,DeliveryPeriodStartDate
,Description
,DlDtlPrvsnID
,DlDtlPrvsnRwID
,DlDtlPrvsnRwID2
,DlDtlPrvsnRwID3
,DlDtlTmplteID
,DlvyProductA
,Ele
,Energy
,EstimatedMovementDate
,EstPmtDate
--,ExposureID
,ExposureType
,ExternalBAID
,FlatPriceOrBasis
,FloatPnl
,FloatPosition
,FwdAmountA
,Ile
,InitDealPrice
,InitialDealVolume
,InitSysPrice
,InitSysVolume
,InternalBAID
,InvoiceNumber
,LocaleID
,MarketCrrncyID
,MarketCurrency
,MarketPerUnitValue
,MarketValue
,MarketValueFXConversionDate
,MarketValueIsMissing
,MaxPeriodStartDate
,MethodofTransportation
,MovementStatus
,MTMRunType
,PaymentCrrncyID
,PaymentCurrency
,PerUnitValue
,Portfolio
,Position
,PriceDescription
,PricedInPercentage
,PricedInPerUnitValue
,PricedPnL
,PricedValueFXRate
,PriceProductA
,PriceType
,PricingSeq
,Product
,ProductID
,Provision
,RD
,RiskAdjustmentID
,RiskID
,RiskPriceIdentifierID
,RunDate
,SalesInvoiceNumber
,SentToMSAP
,SentToParagon
,SettledAmountA
,SettledVolumeA
,SnapshotID
,SnapshotInstanceDateTime
,SnapshotIsArchived
,SoldTo
,Source
,SourceSystem
,SourceTable
,SpecificGravity
,StrategyID
,TemplateName
,TimeBasedDlDtlPrvsnRwID
,TmplteSrceTpe
,TotalPnL
,TotalQuantity
,TotalValueFXRate
,Trader
,TradeTag
,TradeType
,TransDate
,UserID
,VolumeUOM
) as
 (
 select 
AccountingPeriodStartDate
,AggregationGroupName
,Agreement
,AgreementType
,AttachedInHouse
,BaseUOM
,BestAvailableQuantity
,BuySell
,ChargeType
,ChmclID
,ClassOfTrade
,CloseOfBusiness
,CommDeal
,ConversionCrrncyID
,ConversionCurrency
,ConversionDeliveryPeriodID
,ConversionFactor
,CreationDate
,CurFxRate
,CurveName
,CustomStatus
,DealCoveredByLoC
,DealCurrency
,DealDetailId
,DealHeaderId
,DealNotionalValue
,DealPriceSource
,DealValueFXConversionDate
,DealValueIsMissing
,DefaultCurrency
,DefaultCurrencyID
,DeliveryPeriod
,DeliveryPeriodEndDate
,DeliveryPeriodStartDate
,Description
,DlDtlPrvsnID
,DlDtlPrvsnRwID
,DlDtlPrvsnRwID2
,DlDtlPrvsnRwID3
,DlDtlTmplteID
,DlvyProductA
,Ele
,Energy
,EstimatedMovementDate
,EstPmtDate
--,ExposureID + @MaxID
,ExposureType
,ExternalBAID
,FlatPriceOrBasis
,FloatPnl
,FloatPosition
,FwdAmountA
,Ile
,InitDealPrice
,InitialDealVolume
,InitSysPrice
,InitSysVolume
,InternalBAID
,InvoiceNumber
,LocaleID
,MarketCrrncyID
,MarketCurrency
,MarketPerUnitValue
,MarketValue
,MarketValueFXConversionDate
,MarketValueIsMissing
,MaxPeriodStartDate
,MethodofTransportation
,MovementStatus
,MTMRunType
,PaymentCrrncyID
,PaymentCurrency
,PerUnitValue
,Portfolio
,Position
,PriceDescription
,PricedInPercentage
,PricedInPerUnitValue
,PricedPnL
,PricedValueFXRate
,PriceProductA
,PriceType
,PricingSeq
,Product
,ProductID
,Provision
,RD
,RiskAdjustmentID
,RiskID
,RiskPriceIdentifierID
,RunDate
,SalesInvoiceNumber
,SentToMSAP
,SentToParagon
,SettledAmountA
,SettledVolumeA
,SnapshotID
,SnapshotInstanceDateTime
,SnapshotIsArchived
,SoldTo
,Source
,SourceSystem
,SourceTable
,SpecificGravity
,StrategyID
,TemplateName
,TimeBasedDlDtlPrvsnRwID
,TmplteSrceTpe
,TotalPnL
,TotalQuantity
,TotalValueFXRate
,Trader
,TradeTag
,TradeType
,TransDate
,UserID
,VolumeUOM
 from MTVCreditInterfaceStaging
 )
insert into MTVCreditInterfaceStagingArchive(
AccountingPeriodStartDate
,AggregationGroupName
,Agreement
,AgreementType
,AttachedInHouse
,BaseUOM
,BestAvailableQuantity
,BuySell
,ChargeType
,ChmclID
,ClassOfTrade
,CloseOfBusiness
,CommDeal
,ConversionCrrncyID
,ConversionCurrency
,ConversionDeliveryPeriodID
,ConversionFactor
,CreationDate
,CurFxRate
,CurveName
,CustomStatus
,DealCoveredByLoC
,DealCurrency
,DealDetailId
,DealHeaderId
,DealNotionalValue
,DealPriceSource
,DealValueFXConversionDate
,DealValueIsMissing
,DefaultCurrency
,DefaultCurrencyID
,DeliveryPeriod
,DeliveryPeriodEndDate
,DeliveryPeriodStartDate
,Description
,DlDtlPrvsnID
,DlDtlPrvsnRwID
,DlDtlPrvsnRwID2
,DlDtlPrvsnRwID3
,DlDtlTmplteID
,DlvyProductA
,Ele
,Energy
,EstimatedMovementDate
,EstPmtDate
--,ExposureID
,ExposureType
,ExternalBAID
,FlatPriceOrBasis
,FloatPnl
,FloatPosition
,FwdAmountA
,Ile
,InitDealPrice
,InitialDealVolume
,InitSysPrice
,InitSysVolume
,InternalBAID
,InvoiceNumber
,LocaleID
,MarketCrrncyID
,MarketCurrency
,MarketPerUnitValue
,MarketValue
,MarketValueFXConversionDate
,MarketValueIsMissing
,MaxPeriodStartDate
,MethodofTransportation
,MovementStatus
,MTMRunType
,PaymentCrrncyID
,PaymentCurrency
,PerUnitValue
,Portfolio
,Position
,PriceDescription
,PricedInPercentage
,PricedInPerUnitValue
,PricedPnL
,PricedValueFXRate
,PriceProductA
,PriceType
,PricingSeq
,Product
,ProductID
,Provision
,RD
,RiskAdjustmentID
,RiskID
,RiskPriceIdentifierID
,RunDate
,SalesInvoiceNumber
,SentToMSAP
,SentToParagon
,SettledAmountA
,SettledVolumeA
,SnapshotID
,SnapshotInstanceDateTime
,SnapshotIsArchived
,SoldTo
,Source
,SourceSystem
,SourceTable
,SpecificGravity
,StrategyID
,TemplateName
,TimeBasedDlDtlPrvsnRwID
,TmplteSrceTpe
,TotalPnL
,TotalQuantity
,TotalValueFXRate
,Trader
,TradeTag
,TradeType
,TransDate
,UserID
,VolumeUOM)

select 
AccountingPeriodStartDate
,AggregationGroupName
,Agreement
,AgreementType
,AttachedInHouse
,BaseUOM
,BestAvailableQuantity
,BuySell
,ChargeType
,ChmclID
,ClassOfTrade
,CloseOfBusiness
,CommDeal
,ConversionCrrncyID
,ConversionCurrency
,ConversionDeliveryPeriodID
,ConversionFactor
,CreationDate
,CurFxRate
,CurveName
,CustomStatus
,DealCoveredByLoC
,DealCurrency
,DealDetailId
,DealHeaderId
,DealNotionalValue
,DealPriceSource
,DealValueFXConversionDate
,DealValueIsMissing
,DefaultCurrency
,DefaultCurrencyID
,DeliveryPeriod
,DeliveryPeriodEndDate
,DeliveryPeriodStartDate
,Description
,DlDtlPrvsnID
,DlDtlPrvsnRwID
,DlDtlPrvsnRwID2
,DlDtlPrvsnRwID3
,DlDtlTmplteID
,DlvyProductA
,Ele
,Energy
,EstimatedMovementDate
,EstPmtDate
--,ExposureID
,ExposureType
,ExternalBAID
,FlatPriceOrBasis
,FloatPnl
,FloatPosition
,FwdAmountA
,Ile
,InitDealPrice
,InitialDealVolume
,InitSysPrice
,InitSysVolume
,InternalBAID
,InvoiceNumber
,LocaleID
,MarketCrrncyID
,MarketCurrency
,MarketPerUnitValue
,MarketValue
,MarketValueFXConversionDate
,MarketValueIsMissing
,MaxPeriodStartDate
,MethodofTransportation
,MovementStatus
,MTMRunType
,PaymentCrrncyID
,PaymentCurrency
,PerUnitValue
,Portfolio
,Position
,PriceDescription
,PricedInPercentage
,PricedInPerUnitValue
,PricedPnL
,PricedValueFXRate
,PriceProductA
,PriceType
,PricingSeq
,Product
,ProductID
,Provision
,RD
,RiskAdjustmentID
,RiskID
,RiskPriceIdentifierID
,RunDate
,SalesInvoiceNumber
,SentToMSAP
,SentToParagon
,SettledAmountA
,SettledVolumeA
,SnapshotID
,SnapshotInstanceDateTime
,SnapshotIsArchived
,SoldTo
,Source
,SourceSystem
,SourceTable
,SpecificGravity
,StrategyID
,TemplateName
,TimeBasedDlDtlPrvsnRwID
,TmplteSrceTpe
,TotalPnL
,TotalQuantity
,TotalValueFXRate
,Trader
,TradeTag
,TradeType
,TransDate
,UserID
,VolumeUOM
 from StagingRecords

 --Truncate table MTVCreditInterfaceStaging

 
 --exec(@SQL1);


END

Begin
Truncate table MTVCreditInterfaceStaging
End

GO

